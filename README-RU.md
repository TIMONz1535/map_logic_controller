# Map Logic Controller - Lua Inputs/Outputs

**Map Logic Controller** (`MapLogic`) позволяет настраивать логику Инпутов/Оутпутов на карте из Lua.
Если вы не понимаете о чем речь, пожалуйста обратитесь к официальной документации [Valve Developer Wiki](https://developer.valvesoftware.com/wiki/Inputs_and_Outputs).

Контроллер представляет из себя серверную *point* энтить, которая дает возможность создавать оутпуты на стороне Lua для энтитей на карте.
Благодаря этому вы можете с легкостью настраивать сложную логику механизмов, лифтов, дверей, кодовых замков, поездов - всего, что в **Hammer** превращается в сущий ад из десятков логических энтитей, миллионов оутпутов, и часто является невыполнимой задачей.


# Сценарии использования

В общем случае, с этим аддоном вы можете с легкостью создавать логические вещи, которые получаются слишком громоздкие в **Hammer**. Лифт из *func_tracktrain* на 5 этажей? Легко! Как обычно создайте лифт, его путь из *path_track*, 5 кнопок в лифте и по каждой на этаже. Дайте им всем имя, больше в **Hammer** ничего не нужно. Теперь просто получите эти энтити в коде, и напишите всю логику на Lua - добавьте нужные оутпуты и вызывайте инпуты через `Entity:Fire` чтобы открывать двери и запускать/останавливать лифт. Вам даже не нужно настраивать звуки в **Hammer**, ведь их можно воспроизводить прямо из Lua!

Для РП карт вы можете, к примеру, заприватить кнопки для определенных профессий. Можно настроить логику для разных игровых режимов, ивентов, погод или времен года, и переключать их с помощью `map_logic_override`. Можно изменять или исправлять логику на существующих картах, если переименовать нужные энтити - это полностью заглушит инпуты. Однако это не сработает на оутпутах с ключевыми словами [Keywords](https://developer.valvesoftware.com/wiki/Targetname#Keywords) `!activator`, `!self`, `!player`. **Нет способа удалить оутпут из энтити [#1984](https://github.com/Facepunch/garrysmod-requests/issues/1984). Альтернативно, вы можете заглушить их все через `GM:AcceptInput`.**

Для кооп-карт или карт на прохождение вы можете настроить логику спавна NPC, контролировать волны врагов и спавн боссов. Запускать сложные сцены по триггерам и кнопкам, давать игрокам боеприпасы и оружие без уродливых манипуляций с **Hammer** энтитями! Вы с легкостью можете использовать все преимущества Lua, создавать таймеры, логические if else, switch-case, математические операции, вычисление интегралов, получение времени компьютера... Возможности применения этого аддона ограничены лишь вашей фантазией.


# Рекомендации по безопасности

Важно понимать, что я не отвечаю за скрипты, который люди делают для своих карт. Эта энтить **не** является альтернативой `lua_run`, она **не запускает код** и не создается из **Hammer**. Эта энтить призвана дать легкий контроль над логикой карты со стороны Lua скриптов, но все что напишет автор скрипта лежит на его совести.

На Lua вы можете делать все что угодно, начиная от простой шалости, заканчивая серьезными вопросами безопасности. Не пытайтесь создавать секретные кнопки, которые дают игроку некоторые вещи или админ-доступ. Это схоже с тем, что если бы вы использовали `lua_run` для веселья, не делайте так! **Обратите внимание, что плохим тоном будет проверять доступ по SteamID в секретные комнаты. Пожалуйста, не кикайте и не баньте игроков на своих картах, это очень плохая вещь.**


# Для разработчиков и владельцев серверов

Контроллер создается при старте и при очистке карты, логика инициализируется запуском хука `OnMapLogicInitialized`. Разработчики могут класть свои `.lua` скрипты в аддон с картой или отдельным аддоном.

* Консольная команда `map_logic_reload` - Удаляет старый контроллер и создает новый. Заставляет снова инициализировать всю логику карты. Пожалуйста, не используйте это [слишком много раз](https://github.com/TIMONz1535/map_logic_controller/wiki#a-few-simple-rules).

* Консольная переменная `map_logic_override ""` - Переопределяет имя карты, для которой контроллер инициализирует логику. Таким образом, можно делать несколько пресетов для одной карты. Значение переменной не сохраняется, поэтому вам нужно выставлять ее при старте сервера в `autoexec.cfg` или `server.cfg`.

Вы должны обратиться к моей [вики](https://github.com/TIMONz1535/map_logic_controller/wiki/Home-RU), чтобы посмотреть полную документация с примерами.

---

© 2022 [TIMON_Z1535](https://steamcommunity.com/profiles/76561198047725014)

Steam Workshop: https://steamcommunity.com/workshop/filedetails/?id=2609701688

Wiki: https://github.com/TIMONz1535/map_logic_controller/wiki
